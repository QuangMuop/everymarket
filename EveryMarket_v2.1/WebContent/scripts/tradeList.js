$(document).ready(function() {
	
	
	var t_ids = new Array();
	
	var t_status = new Array();
	
    $("tr[t_ids]").each(function(index){
        
    	 t_ids[index] = $(this).attr("t_ids");
    	 t_status[index] = $(this).attr("t_status");
    	     	 
    	 if(t_status[index] == 1){
    		     		
    		 tradeDwr.db_number_remainday(t_ids[index], show);    	
    		    		   		 
    	 }    	 
    	 function show(data){ 
    		 
    		 //배송기간을 초과하면 삭제해준다.
    		    if(data < 0){
    		    	   tradeDwr.trade_delete(t_ids[index]);
    		     }    		 
    	    	$('#' + t_ids[index] + "1s").append("    입력가능 날짜까지 " + data + "일 남았습니다.");
     	 }
    	 
   	});      
  
		
	var t_status = $("#t_status").attr("name");
	
    // 배송번호 입력했을때 db상태바꿔주는 것
	$(".dn_bt").click(function(event) {
		
		var t_id = $(this).attr("t_id");			
		var db_nb = $("." + t_id + "5").val();
		
		if(!(db_nb > 10000000 && db_nb < 10000000000) ){
			alert("8자리수 이상, 12자리 이하의 알맞은 운송번호를 입력해주세요");
						
		}else{		
		// db trade status바꿔주고
		tradeDwr.update_db_nb(db_nb, t_id);
		//운송번호로 주문번호 바꿔주기
		$('#' + t_id + "4").text(db_nb);
		
		$("tr[t_ids="+t_id+"]").attr("t_status",2);
		
										
		var html = '<input class="db_trace" type="button" value="배송추적" t_id= '
			+ t_id + ' />';
		$("#" + t_id + "1s").html("배송중");
		
				
		$("#" + t_id + "2").html(html);
		$("#" + t_id + "4").text(db_nb);
		}
	});
	
	
	

});

$(document).on('click',	function() {
	
	$(".db_trace").on('click',function() {
		var t_id = $(this).attr("t_id");
		window.open("view/popup_deliver.jsp", "배송조회",
		"width=700,height=700,resizalbe=no");

		$("#" + t_id + "1").text("배송완료");
		$("#" + t_id + "3").text("배송완료");	
		
		$(".db_trace").addClass("dis_tr");
		
		var html = '<input type="button"  id="accept"  t_id='+t_id+' value="수취확인" />	<input id="report" type="button"  t_id='+t_id+'  value="신고하기" /> ';
		
		
		
		$("#button").append(html);
			
		
		
		tradeDwr.update_status(t_id);

	});
	
	//수취확인을 눌렀을시에 바꿔주기
	$(".deliver_submit").click(function(){
		   
		var t_id = $(this).attr("t_id");
		
		 if(confirm("물품결제를 확정하시겠습니까?")){
		      tradeDwr.trade_ok(t_id);	
		      $("#" + t_id).addClass("dis_tr");		      
			}else{
			alert("헐");
		}
		
		
		
		
		
		
	});
	

});


